---
title: "Statistics of Gene Expression Activity"
author: "Suzanne Papik"
date: "11/3/17"
output: 
  html_document:
    fig_height: 3
    fig_width: 5
---
<!-- Don't edit in between this line and the one below -->
```{r include=FALSE}
# Don't delete this chunk if you are using the DataComputing package
library(DataComputing)
library(mosaic)

```
*Source file* 
```{r, results='asis', echo=FALSE}
includeSourceDocuments()
```
<!-- Don't edit the material above this line -->

```{r warning=FALSE}
Narrow <-
  NCI60 %>% 
  tidyr::gather(cellLine,expression,-Probe)
```
```{r}
CellTypes <-
  NCI60cells %>% 
  select(cellLine,tissue) %>% 
  mutate(cellLine=gsub("\\:",".", as.character(cellLine)))
```
```{r}
Narrow<-
  Narrow %>% 
  inner_join(CellTypes)
```
```{r{
Probe_TOP3A<-
  Narrow %>% 
  filter(Probe=="TOP3A")
```
```{r}
SummaryStats<-
  Probe_TOP3A %>% 
  group_by(tissue) %>% 
  summarize(mn_expr = exp(mean(expression,na.rm=TRUE)))
```

###A.6
```{r fig.height=5, fig.width=7,warning=FALSE}
SummaryStats %>% 
  ggplot(aes(x=tissue, y = mn_expr))+
  geom_bar(stat="identity")+
  theme(axis.text.x=element_text(angle=30,hjust=1))
```

###A.7
```{r fig.height=5, fig.width=7,warning=FALSE}
Probe_TOP3A %>% 
  ggplot(aes(x=tissue, y=exp(expression)))+
  geom_point()+
  theme(axis.text.x = element_text(angle=30,hjust=1))
```

###A.8
```{r}
SummaryStats<-Probe_TOP3A %>% group_by(tissue) %>% summarise(mn=mean(expression,na.rm=TRUE),
                                                             se=sd(expression,na.rm = TRUE)/sqrt(n()))
```                                                             
```{r}
SummaryStats<-
  SummaryStats %>% 
  mutate(top=mn+2*se,bottom=mn-2*se)
```
```{r fig.height=5, fig.width=7,warning=FALSE}
SummaryStats %>% 
  ggplot(aes(x=tissue,y=exp(mn)))+
  geom_bar(stat="identity",fill="gray",color=NA)+
  geom_point(data=Probe_TOP3A,aes(x=tissue,y=exp(expression)))+
  theme(axis.text.x = element_text(angle = 30,hjust = 1))
```

###A.9
```{r}
SummaryStats<-
  SummaryStats %>% 
  mutate(top=mn+2*se,bottom=mn-2*se)
```
```{r fig.height=5, fig.width=7,warning=FALSE}
SummaryStats %>% 
  ggplot(aes(x=tissue,y=exp(mn)))+
  geom_bar(stat = "identity",alpha=.2)+
  geom_errorbar(aes(x=tissue,ymax=exp(top),ymin=exp(bottom)),width=.5)+
  theme(axis.text.x =element_text(angle=30,hjust=1))
```

###A.10
```{r fig.height=5, fig.width=7,warning=FALSE}
Probe_TOP3A %>% 
  ggplot(aes(x=tissue,y = exp(expression)))+
  geom_point()+
geom_errorbar(data = SummaryStats,aes(x=tissue,ymax=exp(top),ymin=exp(bottom),y=NULL,width=.5))+
theme(axis.text.x = element_text(angle=30,hjust = 1))
```

###A.11
```{r}
r2<-function(data){mosaic::rsquared(lm(data$expression~data$tissue))}

ProbeR2<-
  Narrow %>% 
  group_by(Probe) %>% 
  do(r2=r2(.)) %>% 
  mutate(r2=unlist(r2))
```  
```{r}
Actual<-
  ProbeR2 %>% arrange(desc(r2)) %>% 
  head(30) %>%
  mutate(Probe=reorder(Probe,desc(r2)))
```
```{r fig.height=5, fig.width=7,warning=FALSE}
Actual %>%
  ggplot(aes(x=Probe,y=r2))+
  geom_point()+
  theme(axis.text.x = element_text(angle = 45,hjust = 1))
```

###Your Turn A.10
```{r fig.height=5, fig.width=7,warning=FALSE}
#R^2 Value of 0.9489964
Probe_CD53<-Narrow %>% filter(Probe=="CD53")

Probe_CD53 %>% 
  ggplot(aes(x=tissue,y = exp(expression)))+
  geom_point()+
  geom_errorbar(data = SummaryStats,aes(x=tissue,ymax=exp(top),ymin=exp(bottom),y=NULL))+
  theme(axis.text.x = element_text(angle=30,hjust = 1))
```

There seems to be more overlap over the points in this graph and most of the points seem to be outside the error bars.

###A.12
```{r }
NullR2 <- Narrow %>% 
  group_by(Probe) %>% 
  mutate(expression=mosaic::shuffle(expression)) %>% 
  group_by(Probe) %>% 
  do(r2=r2(.)) %>% 
  mutate(r2=unlist(r2))
```
```{r fig.height=5, fig.width=7,warning=FALSE}
ProbeR2 %>% 
  ggplot(aes(x=r2))+
  geom_density(fill="blue",alpha=.5,color=NA)+
  geom_density(data = NullR2,aes(x=r2),
               fill="red",alpha=.75,color=NA)
```

###A.13
```{r fig.height=5, fig.width=7,warning=FALSE}
Null<-
  NullR2 %>% 
  arrange(desc(r2)) %>% 
  head(30)
Actual$null<-Null$r2
Actual %>% 
  ggplot(aes(x=Probe,y=r2))+
  geom_point()+
  geom_point(aes(y=null),color="gray50")+
  theme(axis.text.x = element_text(angle=45,hjust = 1))
```
